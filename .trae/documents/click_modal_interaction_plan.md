# 点击触发模态交互方案规划

## 1. 目标
将任务列表的交互方式从“拖拽/长按”完全改为“点击触发模态弹窗”模式。该模式将统一桌面端和移动端的交互体验，并增加撤销、加载状态及无障碍支持。

## 2. 核心功能需求
- [ ] **点击触发**：点击任务卡片即可触发交互，不再依赖拖拽。
- [ ] **模态弹窗 (Modal)**：
    - 显示可选状态列表（待办、进行中、已完成）。
    - 每个选项包含图标和文字说明。
    - 包含取消按钮。
    - 支持点击遮罩层关闭。
- [ ] **加载状态**：操作期间显示加载反馈。
- [ ] **撤销功能 (Undo)**：记录操作历史，允许用户撤销最近的状态变更。
- [ ] **无障碍 (A11y)**：
    - 支持键盘导航（Tab/方向键选择选项）。
    - 支持 ESC 键关闭。
    - 完善的 ARIA 属性。
- [ ] **响应式设计**：适配移动端和桌面端。

## 3. 实施步骤

### 第一阶段：清理与基础结构 (Cleanup & Structure)
1.  **移除旧逻辑**：
    - 移除 `dragstart`, `dragover`, `drop` 等原生拖拽事件监听器。
    - 移除之前实现的 `touchstart`, `touchmove`, `touchend` 长按/触摸拖拽逻辑。
    - 清理相关的 CSS 类（如 `cursor-move` 改为 `cursor-pointer`）。
2.  **状态管理扩展**：
    - 在 `state` 对象中添加 `history` 数组，用于存储操作日志（{taskId, fromStatus, toStatus, timestamp}）。
    - 添加 `undoTimer` 或机制用于管理撤销 Toast 的显示时长。

### 第二阶段：UI 组件开发 (UI Development)
1.  **新增模态框 HTML**：
    - 创建 `#status-modal` 结构。
    - 使用 `<dialog>` 标签或 `div`+`role="dialog"`。
    - 包含状态选项按钮组：
        - 待办 (Todo): 图标 + “待办”
        - 进行中 (Doing): 图标 + “进行中”
        - 已完成 (Done): 图标 + “已完成”
    - 包含“取消”按钮。
2.  **新增撤销 Toast HTML**：
    - 创建固定定位的 Toast 组件，显示“操作已完成 [撤销]”。

### 第三阶段：交互逻辑实现 (Logic Implementation)
1.  **点击事件处理**：
    - 为每个任务卡片绑定 `click` 事件。
    - 点击时：
        - 设置卡片为“加载中”视觉状态（如透明度降低、Spinner）。
        - 模拟短暂延迟（提升感知体验）。
        - 弹出 `#status-modal`。
        - 将焦点聚焦到模态框内的当前状态或第一个选项上。
2.  **状态变更处理**：
    - 用户点击选项后：
        - 记录当前状态到 `history`。
        - 更新数据模型中的 `status`。
        - 触发视图重新渲染 `render()`。
        - 显示撤销 Toast。
        - 关闭模态框。
        - 移除卡片“加载中”状态。
3.  **撤销逻辑**：
    - 点击 Toast 中的“撤销”：
        - 从 `history` 弹出一项。
        - 恢复数据状态。
        - 重新渲染。
        - 隐藏 Toast。

### 第四阶段：无障碍与细节优化 (A11y & Polish)
1.  **键盘导航**：
    - 确保模态框打开时捕获焦点 (Focus Trap)。
    - 监听 `keydown`：ESC 关闭，Enter 确认。
2.  **外部点击关闭**：
    - 监听遮罩层点击事件以关闭模态框。
3.  **图标完善**：
    - 使用 SVG 图标增强视觉识别度。

## 4. 文件变更清单
- `apps/web/index.html`:
    - **HTML**: 添加 Modal 和 Toast 结构。
    - **CSS (Tailwind)**: 添加必要的动画和布局样式。
    - **JS**: 重写事件绑定逻辑，添加状态管理和 UI 控制代码。

## 5. 验证计划
- 桌面端鼠标点击测试。
- 移动端触摸点击测试。
- 键盘 Tab/Enter/Esc 流程测试。
- 屏幕阅读器 (VoiceOver/NVDA) 模拟测试（通过代码检查 ARIA 属性）。
- 撤销功能功能性测试。
