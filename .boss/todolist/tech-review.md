# 技术评审与实施建议（Tech Review）

## 1. 总评
- 方案可行：Next.js + FastAPI 架构清晰；PWA 与离线策略合理；Python 生态成熟。
- 风险可控：鉴权、安全与调度明确；部署可走容器与常用云托管。

## 2. 关键风险与缓解
- 鉴权与安全：统一 JWT、输入校验、速率限制；避免敏感信息入库与日志。\n
  - 缓解：中间件与统一错误响应；密码哈希使用 bcrypt；令牌短期有效与刷新策略（后续）。\n
- 离线与冲突：IndexedDB 快照与增量同步；可能出现并发覆盖。\n
  - 缓解：以服务器 updatedAt 为准，返回冲突提示与合并策略（后续增强）。\n
- 调度可靠性：APScheduler 任务持久化与重启恢复。\n
  - 缓解：记录任务表与最后触发时间；失败重试策略；必要时迁移到云定时服务。\n
- 部署环境差异：开发 SQLite 与生产 Postgres 差异。\n
  - 缓解：用 Alembic 迁移与 Pydantic 校验，CI 检查基本兼容性。\n

## 3. 代码与规范建议
- 所有函数添加中文函数级注释（功能、参数、返回值）。\n
- 目录规范与命名统一，前后端错误处理结构一致（code/message/details）。\n
- API 契约稳定后，前端封装统一客户端，禁止在视图层直接发请求。\n
- 日志分级（info/warn/error），接口失败统一返回。\n

## 4. 测试策略
- 前端：Vitest + Testing Library；关键流程 E2E 使用 Playwright。\n
- 后端：pytest + httpx；模型与服务层单测；鉴权与权限覆盖。\n
- 门禁：覆盖率≥70%；A11y 检查通过；关键用例全部通过。\n

## 5. 性能与可维护性
- 使用 Next Image 与懒加载；避免阻塞脚本与布局抖动。\n
- 列表虚拟化（必要时）；查询分页与合理索引（Postgres）。\n
- 封装设计令牌与组件库，复用 UI 与交互模式。\n

